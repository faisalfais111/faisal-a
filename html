<!doctype html>
<html lang="id">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kantin Faisal</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100%;
    }
    
    * {
      box-sizing: border-box;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      text-align: center;
      margin-bottom: 30px;
    }
    
    .header h1 {
      margin: 0 0 10px 0;
      color: #667eea;
      font-size: 42px;
    }
    
    .header p {
      margin: 5px 0;
      color: #666;
      font-size: 18px;
    }
    
    .phone {
      margin-top: 15px;
      padding: 10px 20px;
      background: #667eea;
      color: white;
      border-radius: 25px;
      display: inline-block;
      font-weight: bold;
      font-size: 16px;
    }
    
    .main-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .menu-section {
      background: white;
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    .menu-section h2 {
      margin: 0 0 20px 0;
      color: #667eea;
      font-size: 28px;
      border-bottom: 3px solid #667eea;
      padding-bottom: 10px;
    }
    
    .menu-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      margin-bottom: 10px;
      background: #f8f9fa;
      border-radius: 12px;
      transition: all 0.3s;
      cursor: pointer;
    }
    
    .menu-item:hover {
      background: #e9ecef;
      transform: translateX(5px);
    }
    
    .menu-item-name {
      font-size: 18px;
      font-weight: 500;
      color: #333;
    }
    
    .menu-item-price {
      font-size: 18px;
      font-weight: bold;
      color: #667eea;
    }
    
    .add-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin-left: 15px;
      transition: all 0.3s;
    }
    
    .add-btn:hover {
      background: #5568d3;
      transform: scale(1.05);
    }
    
    .kasir-section {
      background: white;
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      margin-bottom: 30px;
    }
    
    .kasir-section h2 {
      margin: 0 0 20px 0;
      color: #667eea;
      font-size: 28px;
      border-bottom: 3px solid #667eea;
      padding-bottom: 10px;
    }
    
    .order-list {
      margin-bottom: 20px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .order-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 8px;
      margin-bottom: 8px;
    }
    
    .order-item-info {
      flex: 1;
    }
    
    .remove-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }
    
    .remove-btn:hover {
      background: #c82333;
    }
    
    .total-section {
      background: #667eea;
      color: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    
    .total-row {
      display: flex;
      justify-content: space-between;
      font-size: 24px;
      font-weight: bold;
    }
    
    .payment-section {
      margin-bottom: 20px;
    }
    
    .payment-section label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
      font-size: 16px;
    }
    
    .payment-section input {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 18px;
      transition: all 0.3s;
    }
    
    .payment-section input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .change-display {
      background: #28a745;
      color: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 20px;
      display: none;
    }
    
    .action-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    
    .btn-primary {
      background: #28a745;
      color: white;
      border: none;
      padding: 15px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 18px;
      font-weight: bold;
      transition: all 0.3s;
    }
    
    .btn-primary:hover {
      background: #218838;
      transform: translateY(-2px);
    }
    
    .btn-primary:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-secondary {
      background: #6c757d;
      color: white;
      border: none;
      padding: 15px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 18px;
      font-weight: bold;
      transition: all 0.3s;
    }
    
    .btn-secondary:hover {
      background: #5a6268;
      transform: translateY(-2px);
    }
    
    .history-section {
      background: white;
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    .history-section h2 {
      margin: 0 0 20px 0;
      color: #667eea;
      font-size: 28px;
      border-bottom: 3px solid #667eea;
      padding-bottom: 10px;
    }
    
    .history-item {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      border-left: 4px solid #667eea;
    }
    
    .history-item-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-weight: bold;
      color: #333;
    }
    
    .history-item-details {
      color: #666;
      font-size: 14px;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px;
      color: #999;
      font-size: 16px;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @media (max-width: 768px) {
      .main-content {
        grid-template-columns: 1fr;
      }
      
      .header h1 {
        font-size: 32px;
      }
      
      .menu-section h2,
      .kasir-section h2,
      .history-section h2 {
        font-size: 24px;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <div class="header">
    <h1 id="kantin-name">Kantin Faisal</h1>
    <p id="school-name">SMA Negeri 1 Leces</p>
    <div class="phone" id="phone-number">
     üìû 0812-3456-7890
    </div>
   </div>
   <div class="main-content">
    <div class="menu-section">
     <h2>üçΩÔ∏è Makanan</h2>
     <div id="food-menu"></div>
    </div>
    <div class="menu-section">
     <h2>ü•§ Minuman</h2>
     <div id="drink-menu"></div>
    </div>
   </div>
   <div class="kasir-section">
    <h2>üí∞ Kasir Pembayaran</h2>
    <div class="order-list" id="order-list">
     <div class="empty-state">
      Belum ada pesanan
     </div>
    </div>
    <div class="total-section">
     <div class="total-row"><span>Total:</span> <span id="total-amount">Rp 0</span>
     </div>
    </div>
    <div class="payment-section"><label for="payment-input">Uang Dibayar:</label> <input type="number" id="payment-input" placeholder="Masukkan jumlah uang" min="0">
    </div>
    <div class="change-display" id="change-display">
     Kembalian: <span id="change-amount">Rp 0</span>
    </div>
    <div class="action-buttons"><button class="btn-primary" id="process-btn" disabled>Proses Pembayaran</button> <button class="btn-secondary" id="clear-btn">Bersihkan</button>
    </div>
   </div>
   <div class="history-section">
    <h2>üìã Riwayat Transaksi</h2>
    <div id="transaction-history">
     <div class="empty-state">
      Belum ada transaksi
     </div>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      kantin_name: "Kantin Faisal",
      school_name: "SMA Negeri 1 Leces",
      phone_number: "082225015150",
      background_color: "#667eea",
      surface_color: "#ffffff",
      text_color: "#333333",
      primary_action_color: "#28a745",
      secondary_action_color: "#667eea",
      font_family: "Segoe UI",
      font_size: 16
    };

    const foodItems = [
      { name: "Pecel", price: 8000 },
      { name: "Nasi Goreng", price: 12000 },
      { name: "Ayam Geprek", price: 15000 },
      { name: "Bakso", price: 10000 },
      { name: "Mie Ayam", price: 10000 },
      { name: "Roti Bakar", price: 7000 },
      { name: "Aneka Gorengan", price: 2000 }
    ];

    const drinkItems = [
      { name: "Es Teh", price: 3000 },
      { name: "Es Jeruk", price: 5000 },
      { name: "Milo", price: 7000 },
      { name: "Teh Hangat", price: 3000 },
      { name: "Josua", price: 4000 },
      { name: "Wedang Jahe", price: 5000 },
      { name: "Jeruk Hangat", price: 5000 }
    ];

    let currentOrder = [];
    let transactions = [];

    function formatCurrency(amount) {
      return Rp ${amount.toLocaleString('id-ID')};
    }

    function renderMenu() {
      const foodMenu = document.getElementById('food-menu');
      const drinkMenu = document.getElementById('drink-menu');
      
      foodMenu.innerHTML = foodItems.map((item, index) => `
        <div class="menu-item">
          <span class="menu-item-name">${item.name}</span>
          <div>
            <span class="menu-item-price">${formatCurrency(item.price)}</span>
            <button class="add-btn" onclick="addToOrder('${item.name}', ${item.price})">+</button>
          </div>
        </div>
      `).join('');
      
      drinkMenu.innerHTML = drinkItems.map((item, index) => `
        <div class="menu-item">
          <span class="menu-item-name">${item.name}</span>
          <div>
            <span class="menu-item-price">${formatCurrency(item.price)}</span>
            <button class="add-btn" onclick="addToOrder('${item.name}', ${item.price})">+</button>
          </div>
        </div>
      `).join('');
    }

    function addToOrder(name, price) {
      currentOrder.push({ name, price });
      updateOrderDisplay();
    }

    function removeFromOrder(index) {
      currentOrder.splice(index, 1);
      updateOrderDisplay();
    }

    function updateOrderDisplay() {
      const orderList = document.getElementById('order-list');
      const totalAmount = document.getElementById('total-amount');
      const processBtn = document.getElementById('process-btn');
      
      if (currentOrder.length === 0) {
        orderList.innerHTML = '<div class="empty-state">Belum ada pesanan</div>';
        totalAmount.textContent = formatCurrency(0);
        processBtn.disabled = true;
        return;
      }
      
      const total = currentOrder.reduce((sum, item) => sum + item.price, 0);
      
      orderList.innerHTML = currentOrder.map((item, index) => `
        <div class="order-item">
          <div class="order-item-info">
            <strong>${item.name}</strong> - ${formatCurrency(item.price)}
          </div>
          <button class="remove-btn" onclick="removeFromOrder(${index})">Hapus</button>
        </div>
      `).join('');
      
      totalAmount.textContent = formatCurrency(total);
      processBtn.disabled = false;
      
      updateChangeDisplay();
    }

    function updateChangeDisplay() {
      const paymentInput = document.getElementById('payment-input');
      const changeDisplay = document.getElementById('change-display');
      const changeAmount = document.getElementById('change-amount');
      
      const payment = parseInt(paymentInput.value) || 0;
      const total = currentOrder.reduce((sum, item) => sum + item.price, 0);
      
      if (payment >= total && total > 0) {
        const change = payment - total;
        changeAmount.textContent = formatCurrency(change);
        changeDisplay.style.display = 'block';
      } else {
        changeDisplay.style.display = 'none';
      }
    }

    async function processPayment() {
      const paymentInput = document.getElementById('payment-input');
      const processBtn = document.getElementById('process-btn');
      
      const payment = parseInt(paymentInput.value) || 0;
      const total = currentOrder.reduce((sum, item) => sum + item.price, 0);
      
      if (payment < total) {
        const toast = document.createElement('div');
        toast.style.cssText = 'position:fixed;top:20px;right:20px;background:#dc3545;color:white;padding:15px 25px;border-radius:8px;z-index:1000;font-weight:bold;';
        toast.textContent = 'Uang tidak cukup!';
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
        return;
      }
      
      processBtn.disabled = true;
      processBtn.innerHTML = '<span class="loading"></span>';
      
      const change = payment - total;
      const transaction = {
        id: Date.now().toString(),
        items: currentOrder.map(item => item.name).join(', '),
        total: total,
        payment: payment,
        change: change,
        timestamp: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(transaction);
      
      if (result.isOk) {
        const toast = document.createElement('div');
        toast.style.cssText = 'position:fixed;top:20px;right:20px;background:#28a745;color:white;padding:15px 25px;border-radius:8px;z-index:1000;font-weight:bold;';
        toast.textContent = Pembayaran berhasil! Kembalian: ${formatCurrency(change)};
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
        
        clearOrder();
      } else {
        const toast = document.createElement('div');
        toast.style.cssText = 'position:fixed;top:20px;right:20px;background:#dc3545;color:white;padding:15px 25px;border-radius:8px;z-index:1000;font-weight:bold;';
        toast.textContent = 'Gagal menyimpan transaksi';
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
      }
      
      processBtn.disabled = false;
      processBtn.textContent = 'Proses Pembayaran';
    }

    function clearOrder() {
      currentOrder = [];
      document.getElementById('payment-input').value = '';
      document.getElementById('change-display').style.display = 'none';
      updateOrderDisplay();
    }

    function renderTransactionHistory(data) {
      const historyContainer = document.getElementById('transaction-history');
      
      if (data.length === 0) {
        historyContainer.innerHTML = '<div class="empty-state">Belum ada transaksi</div>';
        return;
      }
      
      const sortedData = [...data].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      
      historyContainer.innerHTML = sortedData.map(transaction => {
        const date = new Date(transaction.timestamp);
        const formattedDate = date.toLocaleDateString('id-ID', { 
          day: '2-digit', 
          month: 'short', 
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
        
        return `
          <div class="history-item">
            <div class="history-item-header">
              <span>${formattedDate}</span>
              <span>${formatCurrency(transaction.total)}</span>
            </div>
            <div class="history-item-details">
              <div><strong>Pesanan:</strong> ${transaction.items}</div>
              <div><strong>Dibayar:</strong> ${formatCurrency(transaction.payment)} | <strong>Kembalian:</strong> ${formatCurrency(transaction.change)}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    async function onConfigChange(config) {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'Segoe UI, Tahoma, Geneva, Verdana, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;
      
      document.body.style.fontFamily = ${customFont}, ${baseFontStack};
      document.body.style.fontSize = ${baseSize}px;
      
      const bgGradient = config.background_color || defaultConfig.background_color;
      document.body.style.background = linear-gradient(135deg, ${bgGradient} 0%, #764ba2 100%);
      
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      document.querySelectorAll('.header, .menu-section, .kasir-section, .history-section').forEach(el => {
        el.style.background = surfaceColor;
      });
      
      const textColor = config.text_color || defaultConfig.text_color;
      document.querySelectorAll('.menu-item-name, .order-item-info, .payment-section label').forEach(el => {
        el.style.color = textColor;
      });
      
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
      document.querySelectorAll('.btn-primary').forEach(el => {
        el.style.background = primaryColor;
      });
      
      const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
      document.querySelectorAll('.header h1, .menu-section h2, .kasir-section h2, .history-section h2, .menu-item-price, .phone, .add-btn').forEach(el => {
        el.style.color = el.classList.contains('phone') || el.classList.contains('add-btn') ? 'white' : secondaryColor;
        if (el.classList.contains('phone') || el.classList.contains('add-btn')) {
          el.style.background = secondaryColor;
        }
      });
      
      document.querySelectorAll('.total-section').forEach(el => {
        el.style.background = secondaryColor;
      });
      
      document.getElementById('kantin-name').textContent = config.kantin_name || defaultConfig.kantin_name;
      document.getElementById('school-name').textContent = config.school_name || defaultConfig.school_name;
      document.getElementById('phone-number').textContent = üìû ${config.phone_number || defaultConfig.phone_number};
      
      document.querySelectorAll('h1').forEach(el => el.style.fontSize = ${baseSize * 2.625}px);
      document.querySelectorAll('h2').forEach(el => el.style.fontSize = ${baseSize * 1.75}px);
      document.querySelectorAll('.menu-item-name, .menu-item-price, .btn-primary, .btn-secondary').forEach(el => {
        el.style.fontSize = ${baseSize * 1.125}px;
      });
    }

    const dataHandler = {
      onDataChanged(data) {
        transactions = data;
        renderTransactionHistory(data);
      }
    };

    document.addEventListener('DOMContentLoaded', async () => {
      renderMenu();
      
      document.getElementById('payment-input').addEventListener('input', updateChangeDisplay);
      document.getElementById('process-btn').addEventListener('click', processPayment);
      document.getElementById('clear-btn').addEventListener('click', clearOrder);
      
      if (window.dataSdk) {
        const initResult = await window.dataSdk.init(dataHandler);
        if (!initResult.isOk) {
          console.error('Failed to initialize data SDK');
        }
      }
      
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.background_color || defaultConfig.background_color,
                set: (value) => {
                  config.background_color = value;
                  window.elementSdk.setConfig({ background_color: value });
                }
              },
              {
                get: () => config.surface_color || defaultConfig.surface_color,
                set: (value) => {
                  config.surface_color = value;
                  window.elementSdk.setConfig({ surface_color: value });
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                }
              },
              {
                get: () => config.primary_action_color || defaultConfig.primary_action_color,
                set: (value) => {
                  config.primary_action_color = value;
                  window.elementSdk.setConfig({ primary_action_color: value });
                }
              },
              {
                get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                set: (value) => {
                  config.secondary_action_color = value;
                  window.elementSdk.setConfig({ secondary_action_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                config.font_family = value;
                window.elementSdk.setConfig({ font_family: value });
              }
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                config.font_size = value;
                window.elementSdk.setConfig({ font_size: value });
              }
            }
          }),
          mapToEditPanelValues: (config) => new Map([
            ["kantin_name", config.kantin_name || defaultConfig.kantin_name],
            ["school_name", config.school_name || defaultConfig.school_name],
            ["phone_number", config.phone_number || defaultConfig.phone_number]
          ])
        });
      }
    });
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99c4641586d7ee16',t:'MTc2Mjc2NTU1Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
